<!DOCTYPE html>
<html>
  <head>
    <title>NPMap Tests - NPMap.Map</title>
    <link rel="shortcut icon" type="image/png" href="js/lib/jasmine-1.2.0/jasmine_favicon.png">
    <link rel="stylesheet" type="text/css" href="js/lib/jasmine-1.2.0/jasmine.css">
    <script src="js/lib/jasmine-1.2.0/jasmine.js"></script>
    <script src="js/lib/jasmine-1.2.0/jasmine-html.js"></script>
    <script src="js/spec/helpers.js"></script>
    <script src="js/spec/npmap.map.js"></script>
    <style>
      html, body {
        height: 100%;
        margin: 0;
        overflow: hidden;
        padding: 0;
        width: 100%;
      }
    </style>
  </head>
  <body>
    <div id="map" style="height:300px;left:0;overflow:none;position:absolute;right:0;top:0;">
    </div>
    <div id="jasmine" style="bottom:0;left:0;overflow:auto;position:absolute;right:0;top:300px;">
    </div>
    <script>
      var baseApi = '',
          NPMap = NPMap || {},
          params = window.location.search.substring(1).split('?');
          
      for (var i = 0; i < params.length; i++) {
        var param = params[i];

        if (param.indexOf('baseApi=') !== -1) {
          baseApi = param.replace('baseApi=', '');
        }
      }

      if (baseApi.length === 0) {
        baseApi = 'bing';
      }

      NPMap.config = {
        server: 'http://localhost:1919',

        api: baseApi,
        div: 'map',
        events: {
          init: function(callback) {
            var currentWindowOnload = window.onload,
                htmlReporter = new jasmine.HtmlReporter(document.getElementById('jasmine')),
                jasmineEnv = jasmine.getEnv();

            jasmineEnv.addReporter(htmlReporter);
            jasmineEnv.specFilter = function(spec) {
              return htmlReporter.specFilter(spec);
            };
            jasmineEnv.updateInterval = 1000;

            callback();
            jasmineEnv.execute();
          }
        }
      };
      
      (function() {
        var s = document.createElement('script');
        s.src = NPMap.config.server + '/bootstrap.js';
        s.type = 'text/javascript';
        document.body.appendChild(s);
      })();
    </script>
  </body>
</html>